import React from "react"
import "./index.css"

// Original GitHub comment: https://github.com/alibaba/nacos/issues/6886#issuecomment-1162925345
const data = "我解决了\r\n\r\n我在我的 `nacos` 数据库应用了 [`distribution/conf/nacos-mysql.sql`](https://github.com/alibaba/nacos/blob/2.0.3/distribution/conf/nacos-mysql.sql) 里面 的SQL ，就没什么问题了。\r\n\r\n**（我这个是切换 tag 到版本 `2.0.3` 了，你们谁需要的话注意切到对应的 tag 版本上。）**\r\n\r\n<details>\r\n\r\n<summary>\r\n<code>nacos-mysql-2.0.3.sql</code>\r\n</summary>\r\n\r\n~~~ mysql\r\n/*\r\n * Copyright 1999-2018 Alibaba Group Holding Ltd.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *      http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\n/******************************************/\r\n/*   数据库全名 = nacos_config   */\r\n/*   表名称 = config_info   */\r\n/******************************************/\r\nCREATE TABLE `config_info` (\r\n  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT 'id',\r\n  `data_id` varchar(255) NOT NULL COMMENT 'data_id',\r\n  `group_id` varchar(255) DEFAULT NULL,\r\n  `content` longtext NOT NULL COMMENT 'content',\r\n  `md5` varchar(32) DEFAULT NULL COMMENT 'md5',\r\n  `gmt_create` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',\r\n  `gmt_modified` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '修改时间',\r\n  `src_user` text COMMENT 'source user',\r\n  `src_ip` varchar(50) DEFAULT NULL COMMENT 'source ip',\r\n  `app_name` varchar(128) DEFAULT NULL,\r\n  `tenant_id` varchar(128) DEFAULT '' COMMENT '租户字段',\r\n  `c_desc` varchar(256) DEFAULT NULL,\r\n  `c_use` varchar(64) DEFAULT NULL,\r\n  `effect` varchar(64) DEFAULT NULL,\r\n  `type` varchar(64) DEFAULT NULL,\r\n  `c_schema` text,\r\n  PRIMARY KEY (`id`),\r\n  UNIQUE KEY `uk_configinfo_datagrouptenant` (`data_id`,`group_id`,`tenant_id`)\r\n) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT='config_info';\r\n\r\n/******************************************/\r\n/*   数据库全名 = nacos_config   */\r\n/*   表名称 = config_info_aggr   */\r\n/******************************************/\r\nCREATE TABLE `config_info_aggr` (\r\n  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT 'id',\r\n  `data_id` varchar(255) NOT NULL COMMENT 'data_id',\r\n  `group_id` varchar(255) NOT NULL COMMENT 'group_id',\r\n  `datum_id` varchar(255) NOT NULL COMMENT 'datum_id',\r\n  `content` longtext NOT NULL COMMENT '内容',\r\n  `gmt_modified` datetime NOT NULL COMMENT '修改时间',\r\n  `app_name` varchar(128) DEFAULT NULL,\r\n  `tenant_id` varchar(128) DEFAULT '' COMMENT '租户字段',\r\n  PRIMARY KEY (`id`),\r\n  UNIQUE KEY `uk_configinfoaggr_datagrouptenantdatum` (`data_id`,`group_id`,`tenant_id`,`datum_id`)\r\n) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT='增加租户字段';\r\n\r\n\r\n/******************************************/\r\n/*   数据库全名 = nacos_config   */\r\n/*   表名称 = config_info_beta   */\r\n/******************************************/\r\nCREATE TABLE `config_info_beta` (\r\n  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT 'id',\r\n  `data_id` varchar(255) NOT NULL COMMENT 'data_id',\r\n  `group_id` varchar(128) NOT NULL COMMENT 'group_id',\r\n  `app_name` varchar(128) DEFAULT NULL COMMENT 'app_name',\r\n  `content` longtext NOT NULL COMMENT 'content',\r\n  `beta_ips` varchar(1024) DEFAULT NULL COMMENT 'betaIps',\r\n  `md5` varchar(32) DEFAULT NULL COMMENT 'md5',\r\n  `gmt_create` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',\r\n  `gmt_modified` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '修改时间',\r\n  `src_user` text COMMENT 'source user',\r\n  `src_ip` varchar(50) DEFAULT NULL COMMENT 'source ip',\r\n  `tenant_id` varchar(128) DEFAULT '' COMMENT '租户字段',\r\n  PRIMARY KEY (`id`),\r\n  UNIQUE KEY `uk_configinfobeta_datagrouptenant` (`data_id`,`group_id`,`tenant_id`)\r\n) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT='config_info_beta';\r\n\r\n/******************************************/\r\n/*   数据库全名 = nacos_config   */\r\n/*   表名称 = config_info_tag   */\r\n/******************************************/\r\nCREATE TABLE `config_info_tag` (\r\n  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT 'id',\r\n  `data_id` varchar(255) NOT NULL COMMENT 'data_id',\r\n  `group_id` varchar(128) NOT NULL COMMENT 'group_id',\r\n  `tenant_id` varchar(128) DEFAULT '' COMMENT 'tenant_id',\r\n  `tag_id` varchar(128) NOT NULL COMMENT 'tag_id',\r\n  `app_name` varchar(128) DEFAULT NULL COMMENT 'app_name',\r\n  `content` longtext NOT NULL COMMENT 'content',\r\n  `md5` varchar(32) DEFAULT NULL COMMENT 'md5',\r\n  `gmt_create` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',\r\n  `gmt_modified` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '修改时间',\r\n  `src_user` text COMMENT 'source user',\r\n  `src_ip` varchar(50) DEFAULT NULL COMMENT 'source ip',\r\n  PRIMARY KEY (`id`),\r\n  UNIQUE KEY `uk_configinfotag_datagrouptenanttag` (`data_id`,`group_id`,`tenant_id`,`tag_id`)\r\n) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT='config_info_tag';\r\n\r\n/******************************************/\r\n/*   数据库全名 = nacos_config   */\r\n/*   表名称 = config_tags_relation   */\r\n/******************************************/\r\nCREATE TABLE `config_tags_relation` (\r\n  `id` bigint(20) NOT NULL COMMENT 'id',\r\n  `tag_name` varchar(128) NOT NULL COMMENT 'tag_name',\r\n  `tag_type` varchar(64) DEFAULT NULL COMMENT 'tag_type',\r\n  `data_id` varchar(255) NOT NULL COMMENT 'data_id',\r\n  `group_id` varchar(128) NOT NULL COMMENT 'group_id',\r\n  `tenant_id` varchar(128) DEFAULT '' COMMENT 'tenant_id',\r\n  `nid` bigint(20) NOT NULL AUTO_INCREMENT,\r\n  PRIMARY KEY (`nid`),\r\n  UNIQUE KEY `uk_configtagrelation_configidtag` (`id`,`tag_name`,`tag_type`),\r\n  KEY `idx_tenant_id` (`tenant_id`)\r\n) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT='config_tag_relation';\r\n\r\n/******************************************/\r\n/*   数据库全名 = nacos_config   */\r\n/*   表名称 = group_capacity   */\r\n/******************************************/\r\nCREATE TABLE `group_capacity` (\r\n  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '主键ID',\r\n  `group_id` varchar(128) NOT NULL DEFAULT '' COMMENT 'Group ID，空字符表示整个集群',\r\n  `quota` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '配额，0表示使用默认值',\r\n  `usage` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '使用量',\r\n  `max_size` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '单个配置大小上限，单位为字节，0表示使用默认值',\r\n  `max_aggr_count` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '聚合子配置最大个数，，0表示使用默认值',\r\n  `max_aggr_size` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '单个聚合数据的子配置大小上限，单位为字节，0表示使用默认值',\r\n  `max_history_count` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '最大变更历史数量',\r\n  `gmt_create` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',\r\n  `gmt_modified` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '修改时间',\r\n  PRIMARY KEY (`id`),\r\n  UNIQUE KEY `uk_group_id` (`group_id`)\r\n) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT='集群、各Group容量信息表';\r\n\r\n/******************************************/\r\n/*   数据库全名 = nacos_config   */\r\n/*   表名称 = his_config_info   */\r\n/******************************************/\r\nCREATE TABLE `his_config_info` (\r\n  `id` bigint(64) unsigned NOT NULL,\r\n  `nid` bigint(20) unsigned NOT NULL AUTO_INCREMENT,\r\n  `data_id` varchar(255) NOT NULL,\r\n  `group_id` varchar(128) NOT NULL,\r\n  `app_name` varchar(128) DEFAULT NULL COMMENT 'app_name',\r\n  `content` longtext NOT NULL,\r\n  `md5` varchar(32) DEFAULT NULL,\r\n  `gmt_create` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,\r\n  `gmt_modified` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,\r\n  `src_user` text,\r\n  `src_ip` varchar(50) DEFAULT NULL,\r\n  `op_type` char(10) DEFAULT NULL,\r\n  `tenant_id` varchar(128) DEFAULT '' COMMENT '租户字段',\r\n  PRIMARY KEY (`nid`),\r\n  KEY `idx_gmt_create` (`gmt_create`),\r\n  KEY `idx_gmt_modified` (`gmt_modified`),\r\n  KEY `idx_did` (`data_id`)\r\n) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT='多租户改造';\r\n\r\n\r\n/******************************************/\r\n/*   数据库全名 = nacos_config   */\r\n/*   表名称 = tenant_capacity   */\r\n/******************************************/\r\nCREATE TABLE `tenant_capacity` (\r\n  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '主键ID',\r\n  `tenant_id` varchar(128) NOT NULL DEFAULT '' COMMENT 'Tenant ID',\r\n  `quota` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '配额，0表示使用默认值',\r\n  `usage` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '使用量',\r\n  `max_size` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '单个配置大小上限，单位为字节，0表示使用默认值',\r\n  `max_aggr_count` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '聚合子配置最大个数',\r\n  `max_aggr_size` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '单个聚合数据的子配置大小上限，单位为字节，0表示使用默认值',\r\n  `max_history_count` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '最大变更历史数量',\r\n  `gmt_create` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',\r\n  `gmt_modified` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '修改时间',\r\n  PRIMARY KEY (`id`),\r\n  UNIQUE KEY `uk_tenant_id` (`tenant_id`)\r\n) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT='租户容量信息表';\r\n\r\n\r\nCREATE TABLE `tenant_info` (\r\n  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT 'id',\r\n  `kp` varchar(128) NOT NULL COMMENT 'kp',\r\n  `tenant_id` varchar(128) default '' COMMENT 'tenant_id',\r\n  `tenant_name` varchar(128) default '' COMMENT 'tenant_name',\r\n  `tenant_desc` varchar(256) DEFAULT NULL COMMENT 'tenant_desc',\r\n  `create_source` varchar(32) DEFAULT NULL COMMENT 'create_source',\r\n  `gmt_create` bigint(20) NOT NULL COMMENT '创建时间',\r\n  `gmt_modified` bigint(20) NOT NULL COMMENT '修改时间',\r\n  PRIMARY KEY (`id`),\r\n  UNIQUE KEY `uk_tenant_info_kptenantid` (`kp`,`tenant_id`),\r\n  KEY `idx_tenant_id` (`tenant_id`)\r\n) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT='tenant_info';\r\n\r\nCREATE TABLE `users` (\r\n\t`username` varchar(50) NOT NULL PRIMARY KEY,\r\n\t`password` varchar(500) NOT NULL,\r\n\t`enabled` boolean NOT NULL\r\n);\r\n\r\nCREATE TABLE `roles` (\r\n\t`username` varchar(50) NOT NULL,\r\n\t`role` varchar(50) NOT NULL,\r\n\tUNIQUE INDEX `idx_user_role` (`username` ASC, `role` ASC) USING BTREE\r\n);\r\n\r\nCREATE TABLE `permissions` (\r\n    `role` varchar(50) NOT NULL,\r\n    `resource` varchar(255) NOT NULL,\r\n    `action` varchar(8) NOT NULL,\r\n    UNIQUE INDEX `uk_role_permission` (`role`,`resource`,`action`) USING BTREE\r\n);\r\n\r\nINSERT INTO users (username, password, enabled) VALUES ('nacos', '$2a$10$EuWPZHzz32dJN7jexM34MOeYirDdFAZm2kuWj7VEOJhhZkDrxfvUu', TRUE);\r\n\r\nINSERT INTO roles (username, role) VALUES ('nacos', 'ROLE_ADMIN');\r\n~~~\r\n\r\n</details>\r\n\r\n但，我认为我为 Nacos 创建的数据库，应当就是空着的，然后 Nacos 看我指定的数据库是空的，就会自行在其中做必要的 `source nacos-mysql.sql` 。\r\n\r\n我找了一下， `nacos/nacos-server:2.0.3` 的镜像内，并没有 `nacos-mysql.sql` 这个文件，但是在 Release 的压缩包和源码中都可以找到这个文件。\r\n\r\n这意味着， Nacos 并没有被赋予在自己被指定的 database 中自动初始化 MySQL 表的能力。\r\n\r\n但我认为这是需要有的能力。所以，这依然是一个问题，至少在 `2.0.3` 版本存在这个问题，我只是找到了手动修复的途径罢了。\r\n\r\n希望在未来版本的 Helm 或 Operator 部署中可以为 Nacos 增加自动初始化外部数据库的能力：只要那个库是空的，就要执行初始化（这应该会需要用到至少一个 Init Container 吧）；如果被指定的目标库不为空但是缺少表，也最好明确报错出还缺少什么表、或什么表结构不正确，而不是像现在这样，在显眼位置的有用的信息只有一个 `No DataSource set` 而已。\r\n\r\n"
export default function Home() {
  return <div>
    <p className="comment">{data}</p>
    </div>
}
